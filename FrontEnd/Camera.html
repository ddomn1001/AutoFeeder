<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="popups.css">
    <title>Camera</title>
</head>

<nav>
    <img class='Logo' src="JMU-Logo-2.png" alt="">
    <div class="welcome-message" style="display: none;">Welcome, <span id="firstName"></span>! </div>

    </div>

    <div class="buttons">
        <a href="Home.html"> <button id="home">Home</button> </a>
    </div>
</nav>

<!--HTML Account Popup Code; owned by Nathan Davis --!>
<div id="accountPopup" class="popup">
    <span class="close-btn" onclick="closePopup('accountPopup')">‚ùå</span>
    <h2>Account</h2>
    <p class="userInfo" id="userInfoText"></p>
    <button id="logout" onclick="logout()">Logout</button>

</div>

<body>
    <!-- Camera Feed Section -->
    <div class="camera-feed-container">
        <div class="camera-feed">
            <h2 id="imageUser">Photo from latest feed</h2>
            <!-- Update the src attribute of this image dynamically -->
            <img id="cameraImage" src="" alt="Decrypted Image" style="max-width: 50%; height: auto;">
        </div>
    </div>



    <!-- Include jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    async function fetchMostRecentImage() {

    try {
        const response = await fetch('/get-most-recent-image');
        if (response.ok) {
            const imageData = await response.blob();
            const imageUrl = URL.createObjectURL(imageData);
            document.getElementById('cameraImage').src = imageUrl;


        } else {
            console.error('Failed to fetch most recent image:', response.statusText);
        }
    } catch (error) {
        console.error('Error fetching most recent image:', error);
    }
}

// WebSocket connection URL
const socketUrl = 'wss://www.jmuautofeeder.com';

// Create a new WebSocket instance
const ws = new WebSocket(socketUrl);

// WebSocket message event handler
ws.onmessage = function(event) {
    // Parse the received message as a JSON object
    const message = JSON.parse(event.data);
    
    // Check if the message contains image data
    if (message.image_data) {
        // Fetch the most recent image to update the display
        fetchMostRecentImage();
    }
};

// Function to fetch the most recent image initially when the page loads
window.onload = fetchMostRecentImage;

</script>

</body>
</html>

